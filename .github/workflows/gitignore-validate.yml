name: Validate Gitignore and Repo Cleanliness

on:
  pull_request:
    types: [opened, synchronize, edited, reopened]

jobs:
  validate-gitignore:
    runs-on: ubuntu-latest

    steps:
      - name: Checkout
        uses: actions/checkout@v4

      - name: Ensure forbidden paths are not committed
        run: |
          forbidden_paths=(
            "localstorage"
            "*.db"
            "*.sqlite"
            "uploads"
            "tiles"
            "exports"
          )

          for path in "${forbidden_paths[@]}"; do
            if git ls-files --error-unmatch $path 2>/dev/null; then
              echo "❌ ERROR: Forbidden path found in repo: $path"
              exit 1
            fi
          done

      - name: Success
        run: echo "✔ Repo structure validated"
